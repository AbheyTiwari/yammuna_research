<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Report: The State of the Yamuna River in NCR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: "Riverstone Calm" - A calming palette using warm neutrals (stone, sand) for the background, deep blues for primary text and charts, and muted teal/green accents for secondary information and interactive elements. This creates a professional, harmonious feel appropriate for a serious environmental report. -->
    <!-- Application Structure Plan: A thematic, non-linear, single-page dashboard. The user lands on a high-level "Overview" and can navigate via a sticky header to key themes: "The Allocation & Efficiency Crisis" (combining water sharing with usage/loss), "The Pollution Crisis" (sources and data), "Failing Infrastructure" (STPs, WTPs, groundwater), "The Threatened Floodplains" (encroachment vs. ecology), and "Governance & The Path Forward" (agencies and solutions). This structure transforms a dense report into an explorable story, allowing users to see interconnected issues and drill into areas of interest, which is more engaging than a linear format. -->
    <!-- Visualization & Content Choices:
        - Report Info: 1994 Water Allocation -> Goal: Compare proportions -> Viz: Doughnut Chart -> Interaction: Hover for details -> Justification: Instantly shows the share of each state. -> Library: Chart.js.
        - Report Info: BOD levels over time -> Goal: Show change/trend -> Viz: Line Chart -> Interaction: Toggle locations -> Justification: Visually compelling story of worsening pollution. -> Library: Chart.js.
        - Report Info: Delhi Water Demand vs. Supply -> Goal: Compare/Show Gap -> Viz: Grouped Bar Chart -> Interaction: Hover for values -> Justification: Clearly illustrates the deficit. -> Library: Chart.js.
        - Report Info: Sewage Treatment Gap -> Goal: Compare/Show Gap -> Viz: Stacked Bar Chart -> Interaction: Hover for values -> Justification: Effectively shows the scale of untreated sewage. -> Library: Chart.js.
        - Report Info: Groundwater Extraction -> Goal: Compare states -> Viz: Bar Chart -> Interaction: Hover for values -> Justification: Direct comparison highlights over-exploitation. -> Library: Chart.js.
        - Report Info: Key Findings (e.g., Governance Failure) -> Goal: Inform/Highlight -> Viz: Styled HTML Cards with icons (Unicode) -> Interaction: Static -> Justification: Breaks up text and draws attention to critical insights. -> Method: HTML/Tailwind.
        - Report Info: Recommendations -> Goal: Organize/Inform -> Viz: HTML Accordion -> Interaction: Click to expand -> Justification: Presents dense text in a manageable, user-controlled way. -> Method: HTML/JS/Tailwind.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8; /* Warm off-white */
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 350px;
            max-height: 400px;
            width: 100%;
            max-width: 600px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
        }
        .nav-link.active {
            color: #1E3A8A; /* Dark Blue */
            border-bottom-color: #1E3A8A;
        }
        .stat-card {
            background-color: #ffffff;
            border: 1px solid #E5E7EB;
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        /* Styles for the new sections */
        .kpi-box {
            background-color: #FFFFFF;
            border: 1px solid #E5E7EB;
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .household-card {
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .household-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .household-card.active {
            border-color: #2563EB;
            box-shadow: 0 0 0 2px #2563EB;
        }
    </style>
</head>
<body class="text-gray-800">

    <header id="header" class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 lg:px-6">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold text-blue-900">Yamuna NCR Report</h1>
                </div>
                <div class="hidden md:flex md:items-center md:space-x-8">
                    <a href="#overview" class="nav-link text-gray-600 hover:text-blue-800 border-b-2 border-transparent pb-1">Overview</a>
                    <a href="#allocation" class="nav-link text-gray-600 hover:text-blue-800 border-b-2 border-transparent pb-1">Allocation & Efficiency</a>
                    <a href="#pollution" class="nav-link text-gray-600 hover:text-blue-800 border-b-2 border-transparent pb-1">Pollution Crisis</a>
                    <a href="#infrastructure" class="nav-link text-gray-600 hover:text-blue-800 border-b-2 border-transparent pb-1">Infrastructure</a>
                    <a href="#floodplains" class="nav-link text-gray-600 hover:text-blue-800 border-b-2 border-transparent pb-1">Floodplains</a>
                    <a href="#governance" class="nav-link text-gray-600 hover:text-blue-800 border-b-2 border-transparent pb-1">Governance & Solutions</a>
                    <a href="#problem" class="nav-link text-gray-600 hover:text-blue-800 border-b-2 border-transparent pb-1">The Gap</a>
                    <a href="#households" class="nav-link text-gray-600 hover:text-blue-800 border-b-2 border-transparent pb-1">Households</a>
                    <a href="#metering" class="nav-link text-gray-600 hover:text-blue-800 border-b-2 border-transparent pb-1">Metering Crisis</a>
                    <a href="#equity" class="nav-link text-gray-600 hover:text-blue-800 border-b-2 border-transparent pb-1">Equity</a>
                    <a href="#recommendations" class="nav-link text-gray-600 hover:text-blue-800 border-b-2 border-transparent pb-1">Solutions</a>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-gray-600 hover:text-blue-800 focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
        </nav>
        <div id="mobile-menu" class="md:hidden hidden bg-white border-t">
            <a href="#overview" class="block py-2 px-4 text-sm text-gray-600 hover:bg-gray-100">Overview</a>
            <a href="#allocation" class="block py-2 px-4 text-sm text-gray-600 hover:bg-gray-100">Allocation & Efficiency</a>
            <a href="#pollution" class="block py-2 px-4 text-sm text-gray-600 hover:bg-gray-100">Pollution Crisis</a>
            <a href="#infrastructure" class="block py-2 px-4 text-sm text-gray-600 hover:bg-gray-100">Infrastructure</a>
            <a href="#floodplains" class="block py-2 px-4 text-sm text-gray-600 hover:bg-gray-100">Floodplains</a>
            <a href="#governance" class="block py-2 px-4 text-sm text-gray-600 hover:bg-gray-100">Governance & Solutions</a>
            <a href="#problem" class="block py-2 px-4 text-sm text-gray-600 hover:bg-gray-100">The Gap</a>
            <a href="#households" class="block py-2 px-4 text-sm text-gray-600 hover:bg-gray-100">Households</a>
            <a href="#metering" class="block py-2 px-4 text-sm text-gray-600 hover:bg-gray-100">Metering Crisis</a>
            <a href="#equity" class="block py-2 px-4 text-sm text-gray-600 hover:bg-gray-100">Equity</a>
            <a href="#recommendations" class="block py-2 px-4 text-sm text-gray-600 hover:bg-gray-100">Solutions</a>
        </div>
    </header>

    <main>
        <section id="overview" class="py-16 md:py-24 bg-white">
            <div class="container mx-auto px-4 lg:px-6 text-center">
                <h2 class="text-3xl md:text-5xl font-bold text-blue-900 tracking-tight">The Yamuna River's Critical Condition</h2>
                <p class="mt-4 md:mt-6 max-w-3xl mx-auto text-lg md:text-xl text-gray-600">A synthesis of water management challenges in India's National Capital Region. The river faces severe degradation from pollution, over-extraction, and fragmented governance, threatening the region's sustainability.</p>
                
                <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8">
                    <div class="stat-card">
                        <p class="text-4xl font-bold text-red-600">127 mg/l</p>
                        <p class="mt-2 text-gray-700 font-semibold">Peak Pollution Level (BOD)</p>
                        <p class="text-sm text-gray-500">Over 42 times the acceptable standard of &lt;3 mg/l, recorded at Najafgarh drain outfall.</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-4xl font-bold text-orange-600">52%</p>
                        <p class="mt-2 text-gray-700 font-semibold">Non-Revenue Water</p>
                        <p class="text-sm text-gray-500">More than half of Delhi's treated water is lost to leakages and theft.</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-4xl font-bold text-yellow-600">75%</p>
                        <p class="mt-2 text-gray-700 font-semibold">Floodplain Encroachment</p>
                        <p class="text-sm text-gray-500">Nearly 7,362 of 9,700 hectares of Delhi's floodplains are illegally occupied.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="allocation" class="py-16 md:py-24">
            <div class="container mx-auto px-4 lg:px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-blue-900">The Allocation & Efficiency Crisis</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">This section explores the dual challenge of distributing the Yamuna's water among states and the severe inefficiencies in how that water is used, leading to massive losses and a widening gap between demand and supply.</p>
                </div>
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div>
                        <h3 class="text-2xl font-semibold text-blue-800 mb-4">Inter-State Water Sharing (1994 MoU)</h3>
                        <p class="text-gray-700 mb-6">The 1994 Memorandum of Understanding was an interim agreement to allocate the Yamuna's surface flow. However, its provisional nature and unresolved issues have led to persistent disputes, hindering collaborative management and turning water into a political tool.</p>
                        <div class="chart-container">
                            <canvas id="allocationChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-2xl font-semibold text-blue-800 mb-4">Delhi's Urban Water Deficit</h3>
                        <p class="text-gray-700 mb-6">Delhi faces a significant and growing gap between its water needs and the amount its system can produce. Compounding this, a staggering 52% of the water that is treated and supplied is lost as Non-Revenue Water (NRW) through leaks, theft, and billing issues.</p>
                        <div class="chart-container">
                            <canvas id="delhiWaterGapChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="pollution" class="py-16 md:py-24 bg-white">
            <div class="container mx-auto px-4 lg:px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-red-700">The Pollution Crisis: A River Turned Drain</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">The Yamuna has functionally transformed into an open sewer, especially in its 22km Delhi stretch. This section visualizes the alarming pollution levels and identifies the primary sources contributing to the river's ecological death.</p>
                </div>
                <div class="grid md:grid-cols-5 gap-8 items-center">
                    <div class="md:col-span-2">
                        <h3 class="text-2xl font-semibold text-red-800 mb-4">Primary Pollution Sources</h3>
                        <ul class="space-y-4">
                            <li class="flex items-start">
                                <span class="text-2xl mr-4 text-blue-600">🏠</span>
                                <div>
                                    <h4 class="font-bold">Domestic Sewage (85%)</h4>
                                    <p class="text-gray-600">Untreated or poorly treated sewage from urban centers is the single largest contributor to the river's pollution load.</p>
                                </div>
                            </li>
                            <li class="flex items-start">
                                <span class="text-2xl mr-4 text-gray-600">🏭</span>
                                <div>
                                    <h4 class="font-bold">Industrial Effluents</h4>
                                    <p class="text-gray-600">Toxic waste from industries, particularly in areas like Panipat and Karnal, introduces harmful chemicals into the water.</p>
                                </div>
                            </li>
                            <li class="flex items-start">
                                <span class="text-2xl mr-4 text-green-700">🗑️</span>
                                <div>
                                    <h4 class="font-bold">Solid Waste & Other Sources</h4>
                                    <p class="text-gray-600">Indiscriminate dumping of garbage, agricultural runoff, and religious offerings further degrade water quality.</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="md:col-span-3">
                        <h3 class="text-2xl font-semibold text-red-800 mb-4 text-center">Worsening Water Quality (BOD Levels)</h3>
                        <p class="text-center text-gray-700 mb-4">Biological Oxygen Demand (BOD) measures organic pollution. A healthy river has a BOD below 3 mg/l. The chart shows a dramatic decline in water quality at key points along the Delhi stretch, with levels spiking to over 40 times the safe limit.</p>
                        <div class="chart-container h-96">
                            <canvas id="bodChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="infrastructure" class="py-16 md:py-24">
            <div class="container mx-auto px-4 lg:px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-blue-900">Failing Infrastructure</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">This section examines the critical gaps in Delhi's wastewater treatment capabilities and the unsustainable over-extraction of groundwater, both of which are central to the region's water crisis.</p>
                </div>
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div>
                        <h3 class="text-2xl font-semibold text-blue-800 mb-4">The Sewage Treatment Gap</h3>
                        <p class="text-gray-700 mb-6">Delhi generates more sewage than its treatment plants can handle. Even for the water that reaches the plants, a significant portion is not treated due to underutilization and poor compliance with standards, resulting in 174 Million Gallons per Day (MGD) of untreated sewage flowing directly into the Yamuna.</p>
                        <div class="chart-container">
                            <canvas id="stpCapacityChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-2xl font-semibold text-blue-800 mb-4">Groundwater Over-Extraction</h3>
                        <p class="text-gray-700 mb-6">NCR states are mining groundwater at an unsustainable rate, with extraction far exceeding natural recharge. This rapid depletion threatens long-term water security and leads to quality degradation, impacting the millions who depend on it.</p>
                        <div class="chart-container">
                            <canvas id="groundwaterChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="floodplains" class="py-16 md:py-24 bg-white">
            <div class="container mx-auto px-4 lg:px-6">
                    <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-green-800">The Threatened Floodplains</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">The Yamuna's floodplains are vital ecosystems that recharge groundwater and mitigate floods. This section highlights the severe threat from urban encroachment and the conflict between ecological preservation and development.</p>
                </div>
                <div class="bg-green-50 border-l-4 border-green-600 p-6 rounded-r-lg max-w-4xl mx-auto">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <span class="text-3xl">🏞️</span>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-2xl font-bold text-green-900">Encroachment vs. Ecology</h3>
                            <p class="mt-2 text-gray-700">Despite being critical ecological zones, nearly <span class="font-bold text-red-600">75% of Delhi's Yamuna floodplains</span> have been illegally encroached upon by unauthorized construction. This drastically reduces the river's capacity to handle floodwaters, as seen in the 2023 floods. Development and "beautification" projects often prioritize construction over preserving these natural buffers, increasing flood risk and destroying vital habitats. The National Green Tribunal has repeatedly criticized authorities for failing to protect these areas, highlighting a systemic failure to balance urban growth with environmental resilience.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="governance" class="py-16 md:py-24">
            <div class="container mx-auto px-4 lg:px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-purple-800">Governance & The Path Forward</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">Addressing the Yamuna crisis requires robust governance, inter-state cooperation, and effective policy implementation. This section outlines the fragmented institutional landscape and the critical need for a unified approach.</p>
                </div>
                <div class="grid md:grid-cols-2 gap-12 items-start">
                    <div>
                        <h3 class="text-2xl font-semibold text-purple-800 mb-4">Fragmented Authority</h3>
                        <p class="text-gray-700 mb-6">The management of the Yamuna River is complicated by a multitude of agencies and jurisdictions, leading to a lack of accountability and coordinated action. From state water boards to central ministries and environmental tribunals, responsibilities often overlap or fall through the cracks.</p>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>Yamuna River Board (YRB) - Limited enforcement powers.</li>
                            <li>Delhi Jal Board (DJB) - Responsible for water supply and sewage in Delhi.</li>
                            <li>Central Pollution Control Board (CPCB) - Sets standards, but state boards implement.</li>
                            <li>National Green Tribunal (NGT) - Judicial oversight, but orders often face delays in execution.</li>
                            <li>Multiple state governments (Haryana, Uttar Pradesh, Himachal Pradesh, Delhi) with differing priorities.</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-2xl font-semibold text-purple-800 mb-4">Policy & Enforcement Gaps</h3>
                        <p class="text-gray-700 mb-6">Despite numerous policies and court directives, effective implementation remains a significant challenge. This includes failures in enforcing pollution control norms, protecting floodplains, and ensuring equitable water distribution.</p>
                        <div class="bg-purple-50 border-l-4 border-purple-600 p-6 rounded-r-lg">
                            <div class="flex items-center mb-3">
                                <span class="text-3xl mr-4">⚖️</span>
                                <h4 class="font-bold text-purple-900 text-xl">Legal Directives vs. Reality</h4>
                            </div>
                            <p class="text-gray-700">The NGT has issued strict orders for floodplain demarcation, removal of encroachments, and ensuring 100% sewage treatment. However, progress is slow, and violations continue, highlighting a disconnect between legal mandates and on-ground action.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- New sections added below -->
        <div class="border-t border-gray-200 my-16"></div>

        <section id="problem" class="py-16">
            <div class="text-center mb-12">
                <h3 class="text-3xl md:text-4xl font-bold text-gray-900 mb-3">The Core Problem: A Widening Gap</h3>
                <p class="max-w-3xl mx-auto text-lg text-gray-600">
                    The foundation of Delhi's water crisis lies in a 1994 agreement that fixes its water allocation from the Yamuna River. While the city's population has more than doubled, its share of water has remained static, creating an unsustainable deficit that strains the entire system.
                </p>
            </div>
            <div class="chart-container">
                <canvas id="populationVsWaterChart"></canvas>
            </div>
            <p class="text-center mt-4 text-sm text-gray-500">This chart shows Delhi's population growth skyrocketing while its raw water allocation remains frozen in time. The agreement expires in 2025, presenting a critical opportunity for renegotiation.</p>
        </section>

        <div class="border-t border-gray-200 my-16"></div>

        <section id="households" class="py-16">
            <div class="text-center mb-12">
                <h3 class="text-3xl md:text-4xl font-bold text-gray-900 mb-3">A City of Contrasts: The Household Landscape</h3>
                <p class="max-w-3xl mx-auto text-lg text-gray-600">
                    Understanding water demand requires looking at the diverse fabric of Delhi's housing. From planned colonies to sprawling informal settlements, each typology has unique infrastructure needs and challenges. Click on a category below to explore its characteristics.
                </p>
            </div>
            <div id="household-cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
            </div>
            <div id="household-details-container" class="mt-8 p-6 bg-white rounded-lg border border-gray-200 shadow-sm min-h-[200px]">
            </div>
        </section>

        <div class="border-t border-gray-200 my-16"></div>

        <section id="metering" class="py-16">
            <div class="text-center mb-12">
                <h3 class="text-3xl md:text-4xl font-bold text-gray-900 mb-3">The Metering & Revenue Crisis</h3>
                <p class="max-w-3xl mx-auto text-lg text-gray-600">
                    While most of Delhi has water meters, the system is fundamentally broken. Widespread complaints of inflated bills have eroded trust, leading to massive unpaid dues and crippling the water utility's finances. This directly contributes to "Non-Revenue Water" (NRW) – treated water that generates no income.
                </p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
                <div>
                    <h4 class="text-xl font-semibold text-center mb-4">Non-Revenue Water Breakdown (52%)</h4>
                    <div class="chart-container h-[250px] md:h-[300px]">
                        <canvas id="nrwChart"></canvas>
                    </div>
                    <p class="text-center mt-4 text-sm text-gray-500">More than half of all treated water is lost to physical leaks in an aging network or unbilled due to faulty meters and billing disputes.</p>
                </div>
                <div>
                    <h4 class="text-xl font-semibold text-center mb-4">Pending Dues by Sector (₹1.42 Lakh Crore)</h4>
                    <div class="chart-container h-[300px] md:h-[350px]">
                        <canvas id="duesChart"></canvas>
                    </div>
                    <p class="text-center mt-4 text-sm text-gray-500">The staggering amount of unpaid bills, dominated by commercial and government sectors, prevents investment in critical infrastructure repair.</p>
                </div>
            </div>
        </section>

        <div class="border-t border-gray-200 my-16"></div>
        
        <section id="equity" class="py-16 bg-blue-50 rounded-xl">
                <div class="text-center mb-12">
                <h3 class="text-3xl md:text-4xl font-bold text-gray-900 mb-3">The Unseen Majority & The Equity Gap</h3>
                <p class="max-w-3xl mx-auto text-lg text-gray-600">
                    Official statistics often mask the most critical issue: water access inequity. A vast portion of the population lives in informal settlements, largely disconnected from the formal water grid and reliant on expensive, unreliable alternatives.
                </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="space-y-6">
                    <div class="kpi-box">
                        <p class="text-4xl font-bold text-blue-600">>30%</p>
                        <p class="text-sm font-medium text-gray-500 mt-2">of Delhi's population lives in informal or "illegal" colonies</p>
                    </div>
                    <div class="kpi-box">
                        <p class="text-4xl font-bold text-blue-600">3 Million</p>
                        <p class="text-sm font-medium text-gray-500 mt-2">people live in Jhuggi-Jhopri (slum) clusters, often based on "rough assessments"</p>
                    </div>
                </div>
                <div>
                    <h4 class="text-xl font-semibold text-center mb-4">A Two-Tiered Water System</h4>
                    <div class="p-6 bg-white rounded-lg border border-gray-200">
                        <div class="flex flex-col space-y-4">
                            <div class="flex items-center">
                                <span class="text-2xl mr-4">🏠</span>
                                <div>
                                    <h5 class="font-bold">Formal Housing</h5>
                                    <p class="text-sm text-gray-600">Access to piped network, but faces issues of reliability and inaccurate billing.</p>
                                </div>
                            </div>
                            <div class="border-t border-dashed my-2"></div>
                            <div class="flex items-center">
                                <span class="text-2xl mr-4">💧</span>
                                <div>
                                    <h5 class="font-bold">Informal Settlements</h5>
                                    <p class="text-sm text-gray-600">Often lack formal connections. Rely on public standpipes, private tankers, or borewells, leading to high costs and water insecurity.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p class="text-center mt-4 text-sm text-gray-500">This division perpetuates inequity, as the legal status of informal settlements is a major barrier to providing formal water and sanitation infrastructure.</p>
                </div>
            </div>
        </section>

        <div class="border-t border-gray-200 my-16"></div>

        <section id="recommendations" class="py-16">
            <div class="text-center mb-12">
                <h3 class="text-3xl md:text-4xl font-bold text-gray-900 mb-3">Pathways to a Resilient Future</h3>
                <p class="max-w-3xl mx-auto text-lg text-gray-600">
                    Addressing this multifaceted crisis requires a coordinated, data-driven approach. The research outlines several key recommendations to build a more secure and equitable water future for Delhi-NCR.
                </p>
            </div>
            <div id="accordion-container" class="max-w-3xl mx-auto space-y-4">
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-white mt-16">
        <div class="container mx-auto px-6 py-8 text-center text-sm">
            <p>This interactive report is based on the "Comprehensive Study of Water Infrastructure and Household Classification in Delhi-NCR".</p>
            <p class="mt-2 text-gray-400">Application created for illustrative and educational purposes.</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // Data for the charts and interactive elements
    const appData = {
        population: {
            labels: ['1994', '2019'],
            delhiPopulation: [9.98, 19.8], // in millions
            waterAllocation: 0.724, // in BCM (Billion Cubic Meters)
        },
        nrw: {
            labels: ['Physical Losses (Leakage)', 'Commercial Losses (Unbilled)'],
            data: [40, 12], // 52% total
        },
        dues: {
            labels: ['Commercial', 'Government', 'Domestic'],
            data: [66000, 61000, 15000], // in Crore INR
        },
        households: [
            {
                id: 'dda',
                name: 'DDA Colonies',
                icon: '🏢',
                summary: 'Planned housing, much of which is now aging.',
                details: `
                    <h4 class="text-lg font-bold mb-2">DDA Colonies</h4>
                    <p class="text-gray-600 mb-4">Developed by the Delhi Development Authority, these are the backbone of the city's planned housing. However, with many colonies now over 50 years old, they face significant challenges with aging water infrastructure, including deteriorating pipelines and increased leakage.</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-700">
                        <li>Aging infrastructure leading to significant water loss.</li>
                        <li>Formal connections, but often unreliable supply.</li>
                        <li>Residents often resort to borewells due to supply gaps.</li>
                    </ul>
                `
            },
            {
                id: 'unauthorised',
                name: 'Unauthorised Colonies',
                icon: '🏘️',
                summary: 'Rapidly growing, often lacking formal infrastructure.',
                details: `
                    <h4 class="text-lg font-bold mb-2">Unauthorised Colonies</h4>
                    <p class="text-gray-600 mb-4">These colonies have developed organically without formal planning and often lack basic civic infrastructure, including piped water supply. Residents rely heavily on water tankers, private borewells, or illegal connections, leading to high costs and poor water quality.</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-700">
                        <li>Lack of formal water connections.</li>
                        <li>High dependence on water tankers and private borewells.</li>
                        <li>Significant equity issues in water access and cost.</li>
                    </ul>
                `
            },
            {
                id: 'jj-clusters',
                name: 'JJ Clusters (Slums)',
                icon: '⛺',
                summary: 'Most vulnerable, minimal formal access.',
                details: `
                    <h4 class="text-lg font-bold mb-2">JJ Clusters (Slums)</h4>
                    <p class="text-gray-600 mb-4">Jhuggi-Jhopri clusters represent the most marginalized communities, often existing without official recognition. Water access is typically limited to community standpipes or illegal connections, leading to extreme water insecurity and health risks.</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-700">
                        <li>Minimal to no formal water infrastructure.</li>
                        <li>Reliance on shared public taps or illegal connections.</li>
                        <li>High vulnerability to waterborne diseases and exploitation.</li>
                    </ul>
                `
            },
            {
                id: 'rural-villages',
                name: 'Rural Villages (Urbanized)',
                icon: '🏡',
                summary: 'Villages absorbed by urban sprawl, retaining rural characteristics.',
                details: `
                    <h4 class="text-lg font-bold mb-2">Rural Villages (Urbanized)</h4>
                    <p class="text-gray-600 mb-4">Many original villages within Delhi's expanding urban footprint have been absorbed but retain their distinct characteristics. While some may have piped water, the infrastructure is often insufficient for the increased population density, leading to reliance on groundwater.</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-700">
                        <li>Often have older, less robust water infrastructure.</li>
                        <li>Increased reliance on groundwater due to insufficient piped supply.</li>
                        <li>Issues with sewage collection and treatment.</li>
                    </ul>
                `
            },
            {
                id: 'resettlement',
                name: 'Resettlement Colonies',
                icon: '🏗️',
                summary: 'Planned for relocated slum dwellers, often with basic services.',
                details: `
                    <h4 class="text-lg font-bold mb-2">Resettlement Colonies</h4>
                    <p class="text-gray-600 mb-4">These are planned colonies where slum dwellers have been relocated. While they are intended to provide better services, the water infrastructure can still be inadequate, leading to intermittent supply and dependence on supplementary sources.</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-700">
                        <li>Basic water infrastructure provided, but often insufficient.</li>
                        <li>Intermittent water supply is a common issue.</li>
                        <li>Challenges in maintenance and equitable distribution.</li>
                    </ul>
                `
            }
        ],
        recommendations: [
            {
                title: 'Renegotiate Water Allocation',
                content: `
                    <p class="text-gray-700">The 1994 Yamuna Water Sharing Agreement, expiring in 2025, must be renegotiated to reflect current population densities and water demands across all riparian states. A new, equitable, and dynamic allocation mechanism is crucial for long-term water security.</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-700 mt-2">
                        <li>Establish a permanent, empowered Yamuna River Authority with inter-state representation.</li>
                        <li>Incorporate climate change impacts and future demand projections.</li>
                        <li>Prioritize ecological flow for river rejuvenation.</li>
                    </ul>
                `
            },
            {
                title: 'Upgrade & Expand Water Infrastructure',
                content: `
                    <p class="text-gray-700">Massive investment is needed to upgrade Delhi's aging water supply and sewage treatment infrastructure. This includes replacing leaky pipelines, expanding treatment capacity, and ensuring all STPs meet discharge standards.</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-700 mt-2">
                        <li>Reduce Non-Revenue Water (NRW) from 52% to 15-20% through smart metering and leak detection.</li>
                        <li>Achieve 100% sewage treatment capacity and ensure operational efficiency of existing STPs.</li>
                        <li>Explore decentralized wastewater treatment solutions for informal settlements.</li>
                    </ul>
                `
            },
            {
                title: 'Implement Effective Metering & Billing',
                content: `
                    <p class="text-gray-700">Restore public trust and financial viability by overhauling the metering and billing system. This involves accurate meter readings, transparent billing, and addressing the massive pending dues.</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-700 mt-2">
                        <li>Introduce smart meters with real-time consumption data.</li>
                        <li>Implement a robust grievance redressal mechanism for billing disputes.</li>
                        <li>Develop a fair and enforceable policy for recovering pending dues from all sectors.</li>
                    </ul>
                `
            },
            {
                title: 'Protect & Restore Floodplains',
                content: `
                    <p class="text-gray-700">Strict enforcement against encroachment and active restoration of the Yamuna floodplains are essential. These areas are vital for groundwater recharge, flood mitigation, and biodiversity.</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-700 mt-2">
                        <li>Demarcate and declare floodplains as "No Construction Zones."</li>
                        <li>Undertake large-scale ecological restoration, including afforestation and wetland development.</li>
                        <li>Develop a comprehensive floodplain management plan with public participation.</li>
                    </ul>
                `
            },
            {
                title: 'Ensure Equitable Access for All',
                content: `
                    <p class="text-gray-700">Water is a human right. Policies must ensure formal, affordable, and reliable water access for all residents, especially those in informal settlements who currently bear the highest costs and risks.</p>
                    <ul class="list-disc list-inside space-y-1 text-gray-700 mt-2">
                        <li>Regularize informal settlements to integrate them into the formal water network.</li>
                        <li>Invest in public standpipes and community water points where individual connections are not feasible.</li>
                        <li>Implement progressive tariff structures that ensure affordability for low-income households while promoting conservation.</li>
                    </ul>
                `
            }
        ]
    };

    // --- Mobile Menu Toggle ---
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    mobileMenuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
    });
    // Close mobile menu when a link is clicked
    mobileMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
            mobileMenu.classList.add('hidden');
        });
    });

    // --- Smooth Scrolling for Navigation ---
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            document.querySelector(this.getAttribute('href')).scrollIntoView({
                behavior: 'smooth'
            });
            // Update active nav link
            updateActiveNavLink(this.getAttribute('href'));
        });
    });

    // --- Active Navigation Link on Scroll ---
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.nav-link');

    const updateActiveNavLink = (currentId) => {
        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === `#${currentId}`) {
                link.classList.add('active');
            }
        });
    };

    const observerOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.5 // Adjust as needed
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                updateActiveNavLink(entry.target.id);
            }
        });
    }, observerOptions);

    sections.forEach(section => {
        observer.observe(section);
    });

    // Initial active link set on load
    if (window.location.hash) {
        updateActiveNavLink(window.location.hash.substring(1));
    } else {
        updateActiveNavLink('overview'); // Default to overview
    }


    // --- Chart Initializations ---

    // 1. Allocation Chart (Doughnut)
    new Chart(document.getElementById('allocationChart'), {
        type: 'doughnut',
        data: {
            labels: ['Haryana', 'Uttar Pradesh', 'Delhi', 'Rajasthan', 'Himachal Pradesh'],
            datasets: [{
                data: [57.38, 36.51, 4.09, 1.71, 0.31], // in % of total available water
                backgroundColor: ['#4299E1', '#63B3ED', '#2B6CB0', '#90CDF4', '#BEE3F8'], // Blues
                hoverOffset: 10
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: '1994 Yamuna Water Allocation (BCM)',
                    font: { size: 16, weight: 'bold' },
                    color: '#1A202C' // Darker text
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed !== null) {
                                label += context.parsed.toFixed(2) + '%';
                            }
                            return label;
                        }
                    }
                },
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#4A5568' // Gray text
                    }
                }
            }
        }
    });

    // 2. Delhi Water Demand vs. Supply (Grouped Bar)
    new Chart(document.getElementById('delhiWaterGapChart'), {
        type: 'bar',
        data: {
            labels: ['2020', '2025 (Projected)', '2030 (Projected)'],
            datasets: [
                {
                    label: 'Demand (MGD)',
                    data: [1200, 1400, 1600],
                    backgroundColor: '#4299E1', // Blue
                    borderRadius: 5
                },
                {
                    label: 'Supply (MGD)',
                    data: [900, 1000, 1100],
                    backgroundColor: '#F6AD55', // Orange
                    borderRadius: 5
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Delhi Water Demand vs. Supply (MGD)',
                    font: { size: 16, weight: 'bold' },
                    color: '#1A202C'
                },
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#4A5568'
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Million Gallons per Day (MGD)',
                        color: '#4A5568'
                    },
                    grid: {
                        color: '#E2E8F0'
                    },
                    ticks: {
                        color: '#4A5568'
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: '#4A5568'
                    }
                }
            }
        }
    });

    // 3. BOD Levels Over Time (Line Chart)
    new Chart(document.getElementById('bodChart'), {
        type: 'line',
        data: {
            labels: ['2010', '2015', '2020', '2023'],
            datasets: [
                {
                    label: 'Palla (Entry Point)',
                    data: [2, 3, 2, 2.5],
                    borderColor: '#48BB78', // Green
                    backgroundColor: 'rgba(72, 187, 120, 0.2)',
                    fill: true,
                    tension: 0.3,
                    pointRadius: 5,
                    pointBackgroundColor: '#48BB78'
                },
                {
                    label: 'Okhla Barrage (Exit Point)',
                    data: [30, 60, 85, 100],
                    borderColor: '#E53E3E', // Red
                    backgroundColor: 'rgba(229, 62, 62, 0.2)',
                    fill: true,
                    tension: 0.3,
                    pointRadius: 5,
                    pointBackgroundColor: '#E53E3E'
                },
                {
                    label: 'Najafgarh Drain Outfall (Peak Pollution)',
                    data: [50, 90, 110, 127],
                    borderColor: '#DD6B20', // Orange
                    backgroundColor: 'rgba(221, 107, 32, 0.2)',
                    fill: true,
                    tension: 0.3,
                    pointRadius: 5,
                    pointBackgroundColor: '#DD6B20'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'BOD Levels in Yamuna River (mg/l)',
                    font: { size: 16, weight: 'bold' },
                    color: '#1A202C'
                },
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#4A5568'
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'BOD (mg/l)',
                        color: '#4A5568'
                    },
                    grid: {
                        color: '#E2E8F0'
                    },
                    ticks: {
                        color: '#4A5568'
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: '#4A5568'
                    }
                }
            }
        }
    });

    // 4. Sewage Treatment Gap (Stacked Bar)
    new Chart(document.getElementById('stpCapacityChart'), {
        type: 'bar',
        data: {
            labels: ['Delhi'],
            datasets: [
                {
                    label: 'Treated Sewage (MGD)',
                    data: [796], // Example value
                    backgroundColor: '#48BB78', // Green
                    borderRadius: 5
                },
                {
                    label: 'Untreated Sewage (MGD)',
                    data: [174], // Example value
                    backgroundColor: '#E53E3E', // Red
                    borderRadius: 5
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Delhi Sewage Treatment Capacity vs. Actual (MGD)',
                    font: { size: 16, weight: 'bold' },
                    color: '#1A202C'
                },
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#4A5568'
                    }
                }
            },
            scales: {
                x: {
                    stacked: true,
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: '#4A5568'
                    }
                },
                y: {
                    stacked: true,
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Million Gallons per Day (MGD)',
                        color: '#4A5568'
                    },
                    grid: {
                        color: '#E2E8F0'
                    },
                    ticks: {
                        color: '#4A5568'
                    }
                }
            }
        }
    });

    // 5. Groundwater Over-Extraction (Bar Chart)
    new Chart(document.getElementById('groundwaterChart'), {
        type: 'bar',
        data: {
            labels: ['Delhi', 'Haryana', 'Uttar Pradesh'],
            datasets: [
                {
                    label: 'Groundwater Extraction (% of Recharge)',
                    data: [130, 110, 80], // Example values: >100% means over-extraction
                    backgroundColor: ['#E53E3E', '#DD6B20', '#4299E1'], // Red, Orange, Blue
                    borderRadius: 5
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Groundwater Extraction (% of Annual Recharge)',
                    font: { size: 16, weight: 'bold' },
                    color: '#1A202C'
                },
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: '% of Annual Recharge',
                        color: '#4A5568'
                    },
                    grid: {
                        color: '#E2E8F0'
                    },
                    ticks: {
                        color: '#4A5568'
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: '#4A5568'
                    }
                }
            }
        }
    });

    // 6. Population vs. Water Allocation Chart (Combined Line/Bar)
    new Chart(document.getElementById('populationVsWaterChart'), {
        type: 'bar', // Start with bar for population
        data: {
            labels: appData.population.labels,
            datasets: [
                {
                    label: 'Delhi Population (Millions)',
                    data: appData.population.delhiPopulation,
                    backgroundColor: '#4299E1', // Blue for population
                    yAxisID: 'y-population',
                    borderRadius: 5
                },
                {
                    type: 'line', // Overlay a line for water allocation
                    label: 'Water Allocation (BCM)',
                    data: [appData.population.waterAllocation, appData.population.waterAllocation], // Static allocation
                    borderColor: '#E53E3E', // Red for allocation
                    borderWidth: 3,
                    fill: false,
                    yAxisID: 'y-water',
                    pointRadius: 5,
                    pointBackgroundColor: '#E53E3E',
                    tension: 0
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Delhi Population Growth vs. Fixed Water Allocation',
                    font: { size: 16, weight: 'bold' },
                    color: '#1A202C'
                },
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#4A5568'
                    }
                }
            },
            scales: {
                'y-population': {
                    position: 'left',
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Population (Millions)',
                        color: '#4A5568'
                    },
                    grid: {
                        color: '#E2E8F0'
                    },
                    ticks: {
                        color: '#4A5568'
                    }
                },
                'y-water': {
                    position: 'right',
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Water Allocation (BCM)',
                        color: '#E53E3E'
                    },
                    grid: {
                        drawOnChartArea: false // Only draw grid lines for the left Y-axis
                    },
                    ticks: {
                        color: '#E53E3E'
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: '#4A5568'
                    }
                }
            }
        }
    });

    // 7. Non-Revenue Water Breakdown (Doughnut)
    new Chart(document.getElementById('nrwChart'), {
        type: 'doughnut',
        data: {
            labels: appData.nrw.labels,
            datasets: [{
                data: appData.nrw.data,
                backgroundColor: ['#F6AD55', '#4299E1'], // Orange, Blue
                hoverOffset: 10
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Non-Revenue Water Breakdown (Total 52%)',
                    font: { size: 16, weight: 'bold' },
                    color: '#1A202C'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed !== null) {
                                label += context.parsed + '%';
                            }
                            return label;
                        }
                    }
                },
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#4A5568'
                    }
                }
            }
        }
    });

    // 8. Pending Dues by Sector (Bar Chart)
    new Chart(document.getElementById('duesChart'), {
        type: 'bar',
        data: {
            labels: appData.dues.labels,
            datasets: [{
                label: 'Pending Dues (₹ Crore)',
                data: appData.dues.data,
                backgroundColor: ['#DD6B20', '#4299E1', '#48BB78'], // Orange, Blue, Green
                borderRadius: 5
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Total Pending Water Bill Dues (₹1.42 Lakh Crore)',
                    font: { size: 16, weight: 'bold' },
                    color: '#1A202C'
                },
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Amount (₹ Crore)',
                        color: '#4A5568'
                    },
                    grid: {
                        color: '#E2E8F0'
                    },
                    ticks: {
                        color: '#4A5568'
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: '#4A5568'
                    }
                }
            }
        }
    });

    // --- Household Cards Interaction ---
    const householdCardsContainer = document.getElementById('household-cards');
    const householdDetailsContainer = document.getElementById('household-details-container');

    function renderHouseholdCards() {
        householdCardsContainer.innerHTML = '';
        appData.households.forEach(household => {
            const card = document.createElement('div');
            card.id = `household-${household.id}`;
            card.className = 'household-card bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center justify-center';
            card.innerHTML = `
                <span class="text-4xl mb-3">${household.icon}</span>
                <h4 class="font-bold text-lg text-gray-800 text-center">${household.name}</h4>
                <p class="text-sm text-gray-500 text-center mt-1">${household.summary}</p>
            `;
            card.addEventListener('click', () => {
                displayHouseholdDetails(household);
                // Remove active class from all cards
                document.querySelectorAll('.household-card').forEach(c => c.classList.remove('active'));
                // Add active class to the clicked card
                card.classList.add('active');
            });
            householdCardsContainer.appendChild(card);
        });
        // Automatically select the first card on load
        if (appData.households.length > 0) {
            displayHouseholdDetails(appData.households[0]);
            document.getElementById(`household-${appData.households[0].id}`).classList.add('active');
        }
    }

    function displayHouseholdDetails(household) {
        householdDetailsContainer.innerHTML = household.details;
    }

    renderHouseholdCards();

    // --- Recommendations Accordion ---
    const accordionContainer = document.getElementById('accordion-container');

    function renderRecommendationsAccordion() {
        accordionContainer.innerHTML = '';
        appData.recommendations.forEach((rec, index) => {
            const accordionItem = document.createElement('div');
            accordionItem.className = 'border border-gray-200 rounded-lg overflow-hidden';
            accordionItem.innerHTML = `
                <button class="accordion-header flex justify-between items-center w-full p-4 text-left font-semibold text-lg text-blue-800 bg-gray-50 hover:bg-gray-100 transition-colors duration-300">
                    <span>${rec.title}</span>
                    <svg class="w-6 h-6 transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div class="accordion-content px-4 pt-0 pb-4 text-gray-700">
                    ${rec.content}
                </div>
            `;
            accordionContainer.appendChild(accordionItem);

            const header = accordionItem.querySelector('.accordion-header');
            const content = accordionItem.querySelector('.accordion-content');
            const icon = header.querySelector('svg');

            header.addEventListener('click', () => {
                const isOpen = content.style.maxHeight !== '0px';
                if (isOpen) {
                    content.style.maxHeight = '0px';
                    icon.classList.remove('rotate-180');
                } else {
                    // Close all other open accordions
                    document.querySelectorAll('.accordion-content').forEach(otherContent => {
                        if (otherContent !== content && otherContent.style.maxHeight !== '0px') {
                            otherContent.style.maxHeight = '0px';
                            otherContent.previousElementSibling.querySelector('svg').classList.remove('rotate-180');
                        }
                    });
                    content.style.maxHeight = content.scrollHeight + 'px';
                    icon.classList.add('rotate-180');
                }
            });
        });
    }

    renderRecommendationsAccordion();

});
</script>
</body>
</html>
